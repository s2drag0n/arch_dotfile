(function(){var attachedPrefix,charCodeUnderscore,colors,profileColorPalette,profileColors;angular.module("omega").constant("builtinProfiles",OmegaPac.Profiles.builtinProfiles),colors=[].concat(profileColors=["#9ce","#9d9","#fa8","#fe9","#d497ee","#47b","#5b5","#d63","#ca0"]),profileColorPalette=function(){var _results;for(_results=[];colors.length;)_results.push(colors.splice(0,3));return _results}(),angular.module("omega").constant("profileColors",profileColors),angular.module("omega").constant("profileColorPalette",profileColorPalette),attachedPrefix="__ruleListOf_",angular.module("omega").constant("getAttachedName",(function(name){return attachedPrefix+name})),angular.module("omega").constant("getParentName",(function(name){return 0===name.indexOf(attachedPrefix)?name.substr(attachedPrefix.length):void 0})),charCodeUnderscore="_".charCodeAt(0),angular.module("omega").constant("charCodeUnderscore",charCodeUnderscore),angular.module("omega").constant("isProfileNameHidden",(function(name){return name.charCodeAt(0)===charCodeUnderscore})),angular.module("omega").constant("isProfileNameReserved",(function(name){return name.charCodeAt(0)===charCodeUnderscore&&name.charCodeAt(1)===charCodeUnderscore})),angular.module("omega").config((function($stateProvider,$urlRouterProvider,$httpProvider,$animateProvider,$compileProvider){return $compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|chrome-extension|moz-extension):/),$compileProvider.imgSrcSanitizationWhitelist(/^\s*(https?|local|data|chrome-extension|moz-extension):/),$animateProvider.classNameFilter(/angular-animate/),$urlRouterProvider.otherwise("/about"),$urlRouterProvider.otherwise((function($injector,$location){return""===$location.path()&&$injector.get("omegaTarget").lastUrl()||"/about"})),$stateProvider.state("ui",{url:"/ui",templateUrl:"partials/ui.html"}).state("general",{url:"/general",templateUrl:"partials/general.html"}).state("io",{url:"/io",templateUrl:"partials/io.html",controller:"IoCtrl"}).state("theme",{url:"/theme",templateUrl:"partials/theme.html"}).state("profile",{url:"/profile/*name",templateUrl:"partials/profile.html",controller:"ProfileCtrl"}).state("about",{url:"/about",templateUrl:"partials/about.html",controller:"AboutCtrl"})})),angular.module("omega").factory("$exceptionHandler",(function($log){return function(exception,cause){if("transition aborted"!==exception.message&&"transition superseded"!==exception.message&&"transition prevented"!==exception.message&&"transition failed"!==exception.message)return $log.error(exception,cause)}})),angular.module("omega").factory("omegaDebug",(function($window,$rootScope,$injector){var omegaDebug,_ref;return null==(omegaDebug=null!=(_ref=$window.OmegaDebug)?_ref:{}).downloadLog&&(omegaDebug.downloadLog=function(){var _ref1;return(null!=(_ref1=$injector.get("downloadFile"))?_ref1:saveAs)(new Blob([localStorage.log],{type:"text/plain;charset=utf-8"}),"OmegaLog_"+Date.now()+".txt")}),null==omegaDebug.reportIssue&&(omegaDebug.reportIssue=function(){$window.open("https://github.com/FelisCatus/SwitchyOmega/issues/new?title=&body=")}),null==omegaDebug.resetOptions&&(omegaDebug.resetOptions=function(){return $rootScope.resetOptions()}),omegaDebug})),angular.module("omega").factory("downloadFile",(function(){return function(blob,filename){return saveAs(blob,filename,!0)}}))}).call(this),function(){angular.module("omega").controller("AboutCtrl",(function($scope,$rootScope,$modal,omegaDebug){$scope.downloadLog=function(){return $scope.logDownloading=!0,Promise.resolve(omegaDebug.downloadLog()).then((function(){return $scope.logDownloading=!1}))},$scope.reportIssue=function(){return $scope.issueReporting=!0,omegaDebug.reportIssue().then((function(){return $scope.issueReporting=!1}))},$scope.showResetOptionsModal=function(){return $modal.open({templateUrl:"partials/reset_options_confirm.html"}).result.then((function(){return $scope.optionsReseting=!0,omegaDebug.resetOptions().then((function(){return $scope.optionsReseting=!1}))}))},$scope.htmlLicense="ZeroOm&#8203ega is\n  <a href='https://www.gnu.org/philosophy/free-sw.en.html'>free software</a>\nlicensed under\n<a href='https://www.gnu.org/licenses/gpl.html'>GNU General Public License</a>\nVersion 3 or later.",$scope.htmlCredits="Z&#8203eroOmega is made possible by the\n<a href='https://github.com/suziwen/ZeroOmega'>Ze&#8203roOmega</a>\nopen source project and other\n<a href='https://github.com/FelisCatus/SwitchyOmega/blob/master/AUTHORS'>\nopen source software\n</a>.";try{return $scope.version=omegaDebug.getProjectVersion()}catch(_error){return _error,$scope.version="?.?.?"}}))}.call(this),function(){angular.module("omega").controller("FixedProfileCtrl",(function($scope,$modal,trFilter){var defaultLabel,defaultPort,onBypassListChange,onProxyChange,proxyProperties,scheme,socks5AuthSupported,_fn,_i,_j,_len,_len1,_ref,_ref1,_ref2;for($scope.urlSchemes=["","http","https","ftp"],$scope.urlSchemeDefault="fallbackProxy",proxyProperties={"":"fallbackProxy",http:"proxyForHttp",https:"proxyForHttps",ftp:"proxyForFtp"},$scope.schemeDisp={"":null,http:"http://",https:"https://",ftp:"ftp://"},defaultPort={http:80,https:443,socks4:1080,socks5:1080},$scope.showAdvanced=!1,$scope.optionsForScheme={},_i=0,_len=(_ref=$scope.urlSchemes).length;_i<_len;_i++)defaultLabel=trFilter((scheme=_ref[_i])?"options_protocol_useDefault":"options_protocol_direct"),$scope.optionsForScheme[scheme]=[{label:defaultLabel,value:void 0},{label:"HTTP",value:"http"},{label:"HTTPS",value:"https"},{label:"SOCKS4",value:"socks4"},{label:"SOCKS5",value:"socks5"}];for($scope.proxyEditors={},socks5AuthSupported=null!=("undefined"!=typeof browser&&null!==browser&&null!=(_ref1=browser.proxy)?_ref1.register:void 0),$scope.authSupported={http:!0,https:!0,socks5:socks5AuthSupported},$scope.isProxyAuthActive=function(scheme){var _ref2;return null!=(null!=(_ref2=$scope.profile.auth)?_ref2[proxyProperties[scheme]]:void 0)},$scope.editProxyAuth=function(scheme){var auth,prop,proxy,scope,_ref2;return prop=proxyProperties[scheme],proxy=$scope.profile[prop],(scope=$scope.$new("isolate")).proxy=proxy,auth=null!=(_ref2=$scope.profile.auth)?_ref2[prop]:void 0,scope.auth=auth&&angular.copy(auth),scope.authSupported=$scope.authSupported[proxy.scheme],scope.protocolDisp=proxy.scheme,$modal.open({templateUrl:"partials/fixed_auth_edit.html",scope:scope,size:scope.authSupported?"sm":"lg"}).result.then((function(auth){var _base;return(null!=auth?auth.username:void 0)?(null==(_base=$scope.profile).auth&&(_base.auth={}),$scope.profile.auth[prop]=auth):$scope.profile.auth?$scope.profile.auth[prop]=void 0:void 0}))},onProxyChange=function(proxyEditors,oldProxyEditors){var proxy,_base,_j,_len1,_name,_ref2,_ref3,_results;if(proxyEditors){for(_results=[],_j=0,_len1=(_ref2=$scope.urlSchemes).length;_j<_len1;_j++)proxy=proxyEditors[scheme=_ref2[_j]],$scope.profile.auth&&!$scope.authSupported[proxy.scheme]&&delete $scope.profile.auth[proxyProperties[scheme]],proxy.scheme?(oldProxyEditors[scheme].scheme||(proxy.scheme===proxyEditors[""].scheme&&null==proxy.port&&(proxy.port=proxyEditors[""].port),null==proxy.port&&(proxy.port=defaultPort[proxy.scheme]),null==proxy.host&&(proxy.host=null!=(_ref3=proxyEditors[""].host)?_ref3:"example.com")),_results.push(null!=(_base=$scope.profile)[_name=proxyProperties[scheme]]?_base[_name]:_base[_name]=proxy)):(scheme||(proxyEditors[scheme]={}),delete $scope.profile[proxyProperties[scheme]]);return _results}},_fn=function(scheme){return $scope.$watch((function(){return $scope.profile[proxyProperties[scheme]]}),(function(proxy){return scheme&&proxy&&($scope.showAdvanced=!0),$scope.proxyEditors[scheme]=null!=proxy?proxy:{}}))},_j=0,_len1=(_ref2=$scope.urlSchemes).length;_j<_len1;_j++)_fn(scheme=_ref2[_j]);return $scope.$watch("proxyEditors",onProxyChange,!0),onBypassListChange=function(list){var item;return $scope.bypassList=function(){var _k,_len2,_results;for(_results=[],_k=0,_len2=list.length;_k<_len2;_k++)item=list[_k],_results.push(item.pattern);return _results}().join("\n")},$scope.$watch("profile.bypassList",onBypassListChange,!0),$scope.$watch("bypassList",(function(bypassList,oldList){var entry;if(null!=bypassList&&bypassList!==oldList)return $scope.profile.bypassList=function(){var _k,_len2,_ref3,_results;for(_results=[],_k=0,_len2=(_ref3=bypassList.split(/\r?\n/)).length;_k<_len2;_k++)(entry=_ref3[_k])&&_results.push({conditionType:"BypassCondition",pattern:entry});return _results}()}))}))}.call(this),function(){angular.module("omega").controller("IoCtrl",(function($scope,$rootScope,$window,$http,omegaTarget,downloadFile){var getGistId;return $scope.useBuiltInSync=!0,getGistId=function(gistUrl){var gistId;return null==gistUrl&&(gistUrl=""),gistId=(gistId=(gistId=gistUrl.replace(/\/+$/,"")).split("/"))[gistId.length-1]},omegaTarget.state(["web.restoreOnlineUrl","gistId","gistToken","lastGistSync","lastGistState"]).then((function(_arg){var gistId,gistToken,lastGistState,lastGistSync,url;return url=_arg[0],gistId=_arg[1],gistToken=_arg[2],lastGistSync=_arg[3],lastGistState=_arg[4],url&&($scope.restoreOnlineUrl=url),gistId&&($scope.gistId=gistId,$scope.gistUrl="https://gist.github.com/"+getGistId(gistId)),gistToken&&($scope.gistToken=gistToken),$scope.lastGistSync=new Date(lastGistSync||Date.now()),$scope.lastGistState=lastGistState||""})),$scope.exportOptions=function(){return $rootScope.applyOptionsConfirm().then((function(){var blob,content,plainOptions;return plainOptions=angular.fromJson(angular.toJson($rootScope.options)),content=JSON.stringify(plainOptions),blob=new Blob([content],{type:"text/plain;charset=utf-8"}),downloadFile(blob,"ZeroOmegaOptions.bak")}))},$scope.importSuccess=function(){return $rootScope.showAlert({type:"success",i18n:"options_importSuccess",message:"Options imported."})},$scope.restoreLocal=function(content){return $scope.restoringLocal=!0,$rootScope.resetOptions(content).then((function(){return $scope.importSuccess()}),(function(){return $scope.restoreLocalError()})).finally((function(){return $scope.restoringLocal=!1}))},$scope.restoreLocalError=function(){return $rootScope.showAlert({type:"error",i18n:"options_importFormatError",message:"Invalid backup file!"})},$scope.downloadError=function(){return $rootScope.showAlert({type:"error",i18n:"options_importDownloadError",message:"Error downloading backup file!"})},$scope.triggerFileInput=function(){angular.element("#restore-local-file").click()},$scope.restoreOnline=function(){return omegaTarget.state("web.restoreOnlineUrl",$scope.restoreOnlineUrl),$scope.restoringOnline=!0,$http({method:"GET",url:$scope.restoreOnlineUrl,cache:!1,timeout:1e4,responseType:"text"}).then((function(result){return $rootScope.resetOptions(result.data).then((function(){return $scope.importSuccess()}),(function(){return $scope.restoreLocalError()}))}),$scope.downloadError).finally((function(){return $scope.restoringOnline=!1}))},$scope.enableOptionsSync=function(args){var enable;return null==args&&(args={}),enable=function(){if($scope.gistId&&$scope.gistToken)return args.gistId=$scope.gistId,args.gistToken=$scope.gistToken,args.useBuiltInSync=$scope.useBuiltInSync,$scope.enableOptionsSyncing=!0,omegaTarget.setOptionsSync(!0,args).then((function(){return $window.location.reload()})).catch((function(e){return $scope.enableOptionsSyncing=!1,$rootScope.showAlert({type:"error",message:e+""}),console.log("error:::",e)}));$rootScope.showAlert({type:"error",message:"Gist Id or Gist Token is required"})},(null!=args?args.force:void 0)?enable():$rootScope.applyOptionsConfirm().then(enable)},$scope.checkOptionsSyncChange=function(){return $scope.enableOptionsSyncing=!0,omegaTarget.checkOptionsSyncChange().then((function(){return $window.location.reload()}))},$scope.disableOptionsSync=function(){return omegaTarget.setOptionsSync(!1).then((function(){return $rootScope.applyOptionsConfirm().then((function(){return $window.location.reload()}))}))},$scope.resetOptionsSync=function(){if($scope.gistId&&$scope.gistToken)return omegaTarget.resetOptionsSync({gistId:$scope.gistId,gistToken:$scope.gistToken}).then((function(){return $rootScope.applyOptionsConfirm().then((function(){return $window.location.reload()}))})).catch((function(e){return $rootScope.showAlert({type:"error",message:e+""}),console.log("error:::",e)}));$rootScope.showAlert({type:"error",message:"Gist Id or Gist Token is required"})}}))}.call(this),function(){var __hasProp={}.hasOwnProperty;angular.module("omega").controller("MasterCtrl",(function($scope,$rootScope,$window,$q,$modal,$state,profileColors,profileIcons,omegaTarget,$timeout,$location,$filter,getAttachedName,isProfileNameReserved,isProfileNameHidden,dispNameFilter,downloadFile,themes){var changeTheme,checkFormValid,diff,key,onOptionChange,showFirstRun,showFirstRunOnce,themeItems,tr,type,val,_ref,_ref1,_ref2;for(type in null==("undefined"!=typeof browser&&null!==browser&&null!=(_ref=browser.proxy)?_ref.register:void 0)&&null==("undefined"!=typeof browser&&null!==browser&&null!=(_ref1=browser.proxy)?_ref1.registerProxyScript:void 0)||($scope.isExperimental=!0,$scope.pacProfilesUnsupported=!0),tr=$filter("tr"),$rootScope.options=null,omegaTarget.state("customCss").then((function(customCss){return null==customCss&&(customCss=""),$scope.customCss=customCss})),omegaTarget.addOptionsChangeCallback((function(newOptions){return $rootScope.options=angular.copy(newOptions),$rootScope.optionsOld=angular.copy(newOptions),omegaTarget.state("syncOptions").then((function(syncOptions){return $scope.syncOptions=syncOptions})),$timeout((function(){return $rootScope.optionsDirty=!1,showFirstRun()}))})),$rootScope.revertOptions=function(){if($rootScope.optionsDirty)return $window.location.reload()},$rootScope.exportScript=function(name){return(name?$q.when(name):omegaTarget.state("currentProfileName")).then((function(profileName){var blob,fileName,missingProfile,pac,profileNotFound,_ref2;if(profileName&&"DirectProfile"!==(_ref2=$rootScope.profileByName(profileName).profileType)&&"SystemProfile"!==_ref2)return missingProfile=null,profileNotFound=function(name){return missingProfile=name,"dumb"},pac=OmegaPac.PacGenerator.script($rootScope.options,profileName,{profileNotFound:profileNotFound}).print_to_string({beautify:!0,comments:!0}),pac=OmegaPac.PacGenerator.ascii(pac),blob=new Blob([pac],{type:"text/plain;charset=utf-8"}),fileName=profileName.replace(/\W+/g,"_"),downloadFile(blob,"OmegaProfile_"+fileName+".pac"),missingProfile?$timeout((function(){return $rootScope.showAlert({type:"error",message:tr("options_profileNotFound",[missingProfile])})})):void 0}))},diff=jsondiffpatch.create({objectHash:function(obj){return JSON.stringify(obj)},textDiff:{minLength:1/0}}),$rootScope.showAlert=function(alert){return $timeout((function(){$scope.alert=alert,$scope.alertShown=!0,$scope.alertShownAt=Date.now(),$timeout($rootScope.hideAlert,3e3)}))},$rootScope.hideAlert=function(){return $timeout((function(){if(Date.now()-$scope.alertShownAt>=1e3)return $scope.alertShown=!1}))},checkFormValid=function(){var fields;return!((fields=angular.element(".ng-invalid")).length>0)||(fields[0].focus(),$rootScope.showAlert({type:"error",i18n:"options_formInvalid"}),!1)},$rootScope.applyOptions=function(){var patch,plainOptions;if($rootScope.optionsDirty&&checkFormValid()&&!$rootScope.$broadcast("omegaApplyOptions").defaultPrevented)return plainOptions=angular.fromJson(angular.toJson($rootScope.options)),patch=diff.diff($rootScope.optionsOld,plainOptions),omegaTarget.optionsPatch(patch).then((function(){return $rootScope.showAlert({type:"success",i18n:"options_saveSuccess"})}))},$rootScope.resetOptions=function(options){return omegaTarget.resetOptions(options).then((function(){return $rootScope.showAlert({type:"success",i18n:"options_resetSuccess"})})).catch((function(err){return $rootScope.showAlert({type:"error",message:err}),$q.reject(err)}))},$rootScope.profileByName=function(name){return OmegaPac.Profiles.byName(name,$rootScope.options)},$rootScope.systemProfile=$rootScope.profileByName("system"),$rootScope.externalProfile={color:"#49afcd",name:tr("popup_externalProfile"),profileType:"FixedProfile",fallbackProxy:{host:"127.0.0.1",port:42,scheme:"http"}},$rootScope.applyOptionsConfirm=function(){return checkFormValid()?$rootScope.optionsDirty?$modal.open({templateUrl:"partials/apply_options_confirm.html"}).result.then((function(){return $rootScope.applyOptions()})):$q.when(!0):$q.reject("form_invalid")},$rootScope.newProfile=function(){var scope;return(scope=$rootScope.$new("isolate")).options=$rootScope.options,scope.isProfileNameReserved=isProfileNameReserved,scope.isProfileNameHidden=isProfileNameHidden,scope.profileByName=$rootScope.profileByName,scope.validateProfileName={conflict:"!$value || !profileByName($value)",reserved:"!$value || !isProfileNameReserved($value)"},scope.profileIcons=profileIcons,scope.dispNameFilter=dispNameFilter,scope.options=$scope.options,scope.pacProfilesUnsupported=$scope.pacProfilesUnsupported,$modal.open({templateUrl:"partials/new_profile.html",scope:scope}).result.then((function(profile){var choice;return profile=OmegaPac.Profiles.create(profile),choice=Math.floor(Math.random()*profileColors.length),null==profile.color&&(profile.color=profileColors[choice]),OmegaPac.Profiles.updateRevision(profile),$rootScope.options[OmegaPac.Profiles.nameAsKey(profile)]=profile,$state.go("profile",{name:profile.name})}))},$rootScope.replaceProfile=function(fromName,toName){return $rootScope.applyOptionsConfirm().then((function(){var scope;return(scope=$rootScope.$new("isolate")).options=$rootScope.options,scope.fromName=fromName,scope.toName=toName,scope.profileByName=$rootScope.profileByName,scope.dispNameFilter=dispNameFilter,scope.options=$scope.options,scope.profileSelect=function(model){return'<div omega-profile-select="options | profiles:profile"\n  ng-model="'+model+'" options="options"\n  disp-name="dispNameFilter" style="display: inline-block;">\n</div>'},$modal.open({templateUrl:"partials/replace_profile.html",scope:scope}).result.then((function(_arg){var fromName,toName;return fromName=_arg.fromName,toName=_arg.toName,omegaTarget.replaceRef(fromName,toName).then((function(){return $rootScope.showAlert({type:"success",i18n:"options_replaceProfileSuccess"})})).catch((function(err){return $rootScope.showAlert({type:"error",message:err})}))}))}))},$rootScope.renameProfile=function(fromName){return $rootScope.applyOptionsConfirm().then((function(){var profile,scope;return profile=$rootScope.profileByName(fromName),(scope=$rootScope.$new("isolate")).options=$rootScope.options,scope.fromName=fromName,scope.isProfileNameReserved=isProfileNameReserved,scope.isProfileNameHidden=isProfileNameHidden,scope.profileByName=$rootScope.profileByName,scope.validateProfileName={conflict:"!$value || $value == fromName || !profileByName($value)",reserved:"!$value || !isProfileNameReserved($value)"},scope.dispNameFilter=$scope.dispNameFilter,scope.options=$scope.options,$modal.open({templateUrl:"partials/rename_profile.html",scope:scope}).result.then((function(toName){var attachedName,defaultProfileName,rename,toAttachedName;if(toName!==fromName)return rename=omegaTarget.renameProfile(fromName,toName),attachedName=getAttachedName(fromName),$rootScope.profileByName(attachedName)&&(toAttachedName=getAttachedName(toName),defaultProfileName=void 0,$rootScope.profileByName(toAttachedName)&&(defaultProfileName=profile.defaultProfileName,rename=rename.then((function(){var toAttachedKey;return toAttachedKey=OmegaPac.Profiles.nameAsKey(toAttachedName),(profile=$rootScope.profileByName(toName)).defaultProfileName="direct",OmegaPac.Profiles.updateRevision(profile),delete $rootScope.options[toAttachedKey],$rootScope.applyOptions()}))),rename=rename.then((function(){return omegaTarget.renameProfile(attachedName,toAttachedName)})),defaultProfileName&&(rename=rename.then((function(){return(profile=$rootScope.profileByName(toName)).defaultProfileName=defaultProfileName,$rootScope.applyOptions()})))),rename.then((function(){return $state.go("profile",{name:toName})})).catch((function(err){return $rootScope.showAlert({type:"error",message:err})}))}))}))},$scope.updatingProfile={},$rootScope.updateProfile=function(name){return $rootScope.applyOptionsConfirm().then((function(){return null!=name?$scope.updatingProfile[name]=!0:OmegaPac.Profiles.each($scope.options,(function(key,profile){if(!profile.builtin)return $scope.updatingProfile[profile.name]=!0})),omegaTarget.updateProfile(name,"bypass_cache").then((function(results){var error,profileName,singleErr;for(profileName in 0,error=0,results)__hasProp.call(results,profileName)&&(results[profileName]instanceof Error?error++:0);return 0===error?$rootScope.showAlert({type:"success",i18n:"options_profileDownloadSuccess"}):1===error&&(singleErr=results[OmegaPac.Profiles.nameAsKey(name)])?$q.reject(singleErr):$q.reject(results)})).catch((function(err){var message,_ref2,_ref3,_ref4;return(message=tr("options_profileDownloadError_"+err.name,[null!=(_ref2=null!=(_ref3=err.statusCode)?_ref3:null!=(_ref4=err.original)?_ref4.statusCode:void 0)?_ref2:""]))?$rootScope.showAlert({type:"error",message:message}):$rootScope.showAlert({type:"error",i18n:"options_profileDownloadError"})})).finally((function(){return null!=name?$scope.updatingProfile[name]=!1:$scope.updatingProfile={}}))}))},onOptionChange=function(options,oldOptions){if(options!==oldOptions&&null!=oldOptions)return $rootScope.optionsDirty=!0},$rootScope.$watch("options",onOptionChange,!0),$rootScope.$on("$stateChangeStart",(function(event,_,__,fromState){if(!checkFormValid())return event.preventDefault()})),$rootScope.$on("$stateChangeSuccess",(function(){return omegaTarget.lastUrl($location.url())})),$window.onbeforeunload=function(){return $rootScope.optionsDirty?tr("options_optionsNotSaved"):null},document.addEventListener("click",(function(){return $rootScope.hideAlert()}),!1),$scope.profileIcons=profileIcons,$scope.dispNameFilter=dispNameFilter,_ref2=OmegaPac.Profiles.formatByType)__hasProp.call(_ref2,type)&&($scope.profileIcons[type]=$scope.profileIcons.RuleListProfile);for(key in $scope.alertIcons={success:"glyphicon-ok",warning:"glyphicon-warning-sign",error:"glyphicon-remove",danger:"glyphicon-danger"},$scope.alertClassForType=function(type){return type?("error"===type&&(type="danger"),"alert-"+type):""},$scope.downloadIntervals=[15,60,180,360,720,1440,-1],$scope.downloadIntervalI18n=function(interval){return"options_downloadInterval_"+(interval<0?"never":interval)},themeItems=[],themes)(val=themes[key]).key="others/base16-"+key,val.displayName="("+(val.dark?"ðŸŒš":"ðŸŒž")+")    "+key,themeItems.push(val);return $scope.themeItems=themeItems,$scope.selectedItem={data:null},changeTheme=function(themeKey){var baseCss,getText,themeCss,variableCss;return themeKey?(variableCss="",baseCss="",themeCss="",(getText=function(url){return fetch(url).then((function(res){return res.text()}))})("lib/themes/variable.css").then((function(result){return variableCss=result,getText("lib/themes/"+themeKey+".css")})).then((function(result){return themeCss=result,getText("lib/themes/base.css")})).then((function(result){return baseCss=result})).then((function(){return $scope.customCss=[variableCss,themeCss,baseCss].join("\n"),$scope.options["-customCss"]=$scope.customCss,$scope.$applyAsync()})).catch((function(){return $scope.customCss="",$scope.options["-customCss"]=$scope.customCss,$scope.$applyAsync()}))):($scope.customCss="",void($scope.options["-customCss"]=$scope.customCss))},$scope.selectTheme=function(){var themeItem;return themeItem=$scope.selectedItem||{data:{}},changeTheme(themeItem.data.key)},$scope.changeTheme=changeTheme,$scope.openShortcutConfig=omegaTarget.openShortcutConfig.bind(omegaTarget),showFirstRunOnce=!0,showFirstRun=function(){if(showFirstRunOnce)return showFirstRunOnce=!1,omegaTarget.state("firstRun").then((function(firstRun){var profileName,scope;if(firstRun&&(omegaTarget.state("firstRun",""),profileName=null,OmegaPac.Profiles.each($rootScope.options,(function(key,profile){if(!profileName&&"FixedProfile"===profile.profileType)return profileName=profile.name})),profileName))return(scope=$rootScope.$new("isolate")).upgrade="upgrade"===firstRun,$modal.open({templateUrl:"partials/options_welcome.html",keyboard:!1,scope:scope,backdrop:"static",backdropClass:"opacity-half"}).result.then((function(r){switch(r){case"later":break;case"show":return $state.go("profile",{name:profileName}).then((function(){return $script("js/options_guide.js")}))}}))}))},omegaTarget.refresh()}))}.call(this),function(){angular.module("omega").controller("PacProfileCtrl",(function($scope,$modal){var oldLastUpdate,oldPacScript,oldPacUrl,onProfileChange,set;return $scope.urlRegex=/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,$scope.urlWithFile=/^(ftp|http|https|file):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/,$scope.isFileUrl=OmegaPac.Profiles.isFileUrl,$scope.pacUrlCtrl={ctrl:null},set=OmegaPac.Profiles.referencedBySet($scope.profile,$scope.options),$scope.referenced=Object.keys(set).length>0,oldPacUrl=null,oldLastUpdate=null,oldPacScript=null,onProfileChange=function(profile,oldProfile){if(profile&&oldProfile)return profile.pacUrl!==oldProfile.pacUrl&&(profile.lastUpdate?(oldPacUrl=oldProfile.pacUrl,oldLastUpdate=profile.lastUpdate,oldPacScript=oldProfile.pacScript,profile.lastUpdate=null):oldPacUrl&&profile.pacUrl===oldPacUrl&&(profile.lastUpdate=oldLastUpdate,profile.pacScript=oldPacScript)),$scope.pacUrlIsFile=$scope.isFileUrl(profile.pacUrl)},$scope.$watch("profile",onProfileChange,!0),$scope.editProxyAuth=function(scheme){var auth,prop,scope,_ref;return prop="all",auth=null!=(_ref=$scope.profile.auth)?_ref[prop]:void 0,(scope=$scope.$new("isolate")).auth=auth&&angular.copy(auth),$modal.open({templateUrl:"partials/fixed_auth_edit.html",scope:scope,size:"sm"}).result.then((function(auth){var _base;return(null!=auth?auth.username:void 0)?(null==(_base=$scope.profile).auth&&(_base.auth={}),$scope.profile.auth[prop]=auth):$scope.profile.auth?$scope.profile.auth[prop]=void 0:void 0}))}}))}.call(this),function(){var __hasProp={}.hasOwnProperty;angular.module("omega").controller("ProfileCtrl",(function($scope,$stateParams,$location,$rootScope,$timeout,$state,$modal,profileColorPalette,getAttachedName,getParentName,getVirtualTarget){var name,profileTemplates,unwatch;return name=$stateParams.name,profileTemplates={FixedProfile:"profile_fixed.html",PacProfile:"profile_pac.html",VirtualProfile:"profile_virtual.html",SwitchProfile:"profile_switch.html",RuleListProfile:"profile_rule_list.html"},$scope.spectrumOptions={localStorageKey:"spectrum.profileColor",palette:profileColorPalette,preferredFormat:"hex",showButtons:!1,showInitial:!0,showInput:!0,showPalette:!0,showSelectionPalette:!0,maxSelectionSize:5},$scope.getProfileColor=function(){var color,profile;for(color=void 0,profile=$scope.profile;profile;)color=profile.color,profile=getVirtualTarget(profile,$scope.options);return color},$scope.deleteProfile=function(){var key,parent,pname,profileName,refProfiles,refSet,refs,scope;if(profileName=$scope.profile.name,refs=OmegaPac.Profiles.referencedBySet(profileName,$rootScope.options),(scope=$rootScope.$new("isolate")).profile=$scope.profile,scope.dispNameFilter=$scope.dispNameFilter,scope.options=$scope.options,!(Object.keys(refs).length>0))return $modal.open({templateUrl:"partials/delete_profile.html",scope:scope}).result.then((function(){var attachedName,i,quickSwitch,_i,_ref;for(attachedName=getAttachedName(profileName),delete $rootScope.options[OmegaPac.Profiles.nameAsKey(attachedName)],delete $rootScope.options[OmegaPac.Profiles.nameAsKey(profileName)],$rootScope.options["-startupProfileName"]===profileName&&($rootScope.options["-startupProfileName"]=""),i=_i=0,_ref=(quickSwitch=$rootScope.options["-quickSwitchProfiles"]).length;0<=_ref?_i<_ref:_i>_ref;i=0<=_ref?++_i:--_i)if(profileName===quickSwitch[i]){quickSwitch.splice(i,1);break}return $state.go("ui")}));for(key in refSet={},refs)__hasProp.call(refs,key)&&(pname=refs[key],(parent=getParentName(pname))&&(key=OmegaPac.Profiles.nameAsKey(parent),pname=parent),refSet[key]=pname);for(key in refProfiles=[],refSet)__hasProp.call(refSet,key)&&refProfiles.push(OmegaPac.Profiles.byKey(key,$rootScope.options));scope.refs=refProfiles,$modal.open({templateUrl:"partials/cannot_delete_profile.html",scope:scope})},$scope.watchAndUpdateRevision=function(expression){var onChange,revisionChanged;return revisionChanged=!1,onChange=function(profile,oldProfile){return profile!==oldProfile&&profile&&oldProfile?revisionChanged&&profile.revision!==oldProfile.revision?revisionChanged=!1:(OmegaPac.Profiles.updateRevision(profile),revisionChanged=!0):profile},this.$watch(expression,onChange,!0)},$scope.exportRuleList=null,$scope.exportRuleListOptions=null,$scope.setExportRuleListHandler=function(exportRuleList,options){return $scope.exportRuleList=exportRuleList,$scope.exportRuleListOptions=options},unwatch=$scope.$watch((function(){var _ref;return null!=(_ref=$scope.options)?_ref["+"+name]:void 0}),(function(profile){var templ,type,unwatch2,_ref;if(profile)return OmegaPac.Profiles.formatByType[profile.profileType]&&(profile.format=OmegaPac.Profiles.formatByType[profile.profileType],profile.profileType="RuleListProfile"),$scope.profile=profile,type=$scope.profile.profileType,templ=null!=(_ref=profileTemplates[type])?_ref:"profile_unsupported.html",$scope.profileTemplate="partials/"+templ,$scope.scriptable=!0,$scope.watchAndUpdateRevision("profile");$scope.options?(unwatch(),$location.path("/")):unwatch2=$scope.$watch("options",(function(){if($scope.options&&(unwatch2(),!$scope.options["+"+name]))return unwatch(),$location.path("/")}))}))}))}.call(this),function(){angular.module("omega").controller("QuickSwitchCtrl",(function($scope,$filter){return $scope.sortableOptions={tolerance:"pointer",axis:"y",forceHelperSize:!0,forcePlaceholderSize:!0,connectWith:".cycle-profile-container",containment:"#quick-switch-settings"},$scope.$watchCollection("options",(function(options){var profile;if(null!=options)return $scope.notCycledProfiles=function(){var _i,_len,_ref,_results;for(_results=[],_i=0,_len=(_ref=$filter("profiles")(options,"all")).length;_i<_len;_i++)profile=_ref[_i],options["-quickSwitchProfiles"].indexOf(profile.name)<0&&_results.push(profile.name);return _results}()}))}))}.call(this),function(){angular.module("omega").controller("RuleListProfileCtrl",(function($scope){return $scope.ruleListFormats=OmegaPac.Profiles.ruleListFormats}))}.call(this),function(){var __hasProp={}.hasOwnProperty;angular.module("omega").controller("SwitchProfileCtrl",(function($scope,$rootScope,$location,$timeout,$q,$modal,profileIcons,getAttachedName,omegaTarget,trFilter,downloadFile){var advancedConditionTypesExpanded,attachedReady,attachedReadyDefer,basicConditionTypeSet,basicConditionTypesExpanded,expandGroups,exportLegacyRuleList,exportRuleList,oldLastUpdate,oldRuleList,oldSourceUrl,onAttachedChange,parseOmegaRules,parseSource,rulesReady,rulesReadyDefer,stateEditorKey,stopWatchingForRules,type,unwatchRules,unwatchRulesShowNote,updateHasConditionTypes,_i,_len;for($scope.ruleListFormats=OmegaPac.Profiles.ruleListFormats,exportRuleList=function(){var blob,eol,fileName,info,text;return text=OmegaPac.RuleList.Switchy.compose({rules:$scope.profile.rules,defaultProfileName:$scope.attachedOptions.defaultProfileName}),info="\n",info+="; Require: ZeroOmega >= 2.3.2"+(eol="\r\n"),info+="; Date: "+(new Date).toLocaleDateString()+eol,info+="; Usage: "+trFilter("ruleList_usageUrl")+eol,text=text.replace("\n",info),blob=new Blob([text],{type:"text/plain;charset=utf-8"}),fileName=$scope.profile.name.replace(/\W+/g,"_"),downloadFile(blob,"OmegaRules_"+fileName+".sorl")},exportLegacyRuleList=function(){var blob,fileName,i,regexpRules,rule,text,wildcardRules,_i,_len,_ref;for(wildcardRules="",regexpRules="",_i=0,_len=(_ref=$scope.profile.rules).length;_i<_len;_i++)switch(i="",(rule=_ref[_i]).profileName===$scope.attachedOptions.defaultProfileName&&(i="!"),rule.condition.conditionType){case"HostWildcardCondition":wildcardRules+=i+"@*://"+rule.condition.pattern+"/*\r\n";break;case"UrlWildcardCondition":wildcardRules+=i+"@"+rule.condition.pattern+"\r\n";break;case"UrlRegexCondition":regexpRules+=i+rule.condition.pattern+"\r\n"}return text="; Summary: Proxy Switchy! Exported Rule List\n; Date: "+(new Date).toLocaleDateString()+"\n; Website: "+trFilter("ruleList_usageUrl")+"\n\n#BEGIN\n\n[wildcard]\n"+wildcardRules+"\n[regexp]\n"+regexpRules+"\n#END",blob=new Blob([text],{type:"text/plain;charset=utf-8"}),fileName=$scope.profile.name.replace(/\W+/g,"_"),downloadFile(blob,"SwitchyRules_"+fileName+".ssrl")},$scope.conditionHelp={show:"condition"===$location.search().help},$scope.basicConditionTypes=[{group:"default",types:["HostWildcardCondition","UrlWildcardCondition","UrlRegexCondition","FalseCondition"]}],$scope.advancedConditionTypes=[{group:"host",types:["HostWildcardCondition","HostRegexCondition","HostLevelsCondition","IpCondition"]},{group:"url",types:["UrlWildcardCondition","UrlRegexCondition","KeywordCondition"]},{group:"special",types:["WeekdayCondition","TimeCondition","FalseCondition"]}],expandGroups=function(groups){var group,result,type,_i,_j,_len,_len1,_ref;for(result=[],_i=0,_len=groups.length;_i<_len;_i++)for(_j=0,_len1=(_ref=(group=groups[_i]).types).length;_j<_len1;_j++)type=_ref[_j],result.push({type:type,group:"condition_group_"+group.group});return result},basicConditionTypesExpanded=expandGroups($scope.basicConditionTypes),advancedConditionTypesExpanded=expandGroups($scope.advancedConditionTypes),basicConditionTypeSet={},_i=0,_len=basicConditionTypesExpanded.length;_i<_len;_i++)type=basicConditionTypesExpanded[_i],basicConditionTypeSet[type.type]=type.type;return $scope.conditionTypes=basicConditionTypesExpanded,$scope.showConditionTypes=0,$scope.hasConditionTypes=0,$scope.hasUrlConditions=!1,$scope.isUrlConditionType={UrlWildcardCondition:!0,UrlRegexCondition:!0},updateHasConditionTypes=function(){var rule,_j,_k,_len1,_len2,_ref,_ref1,_ref2,_results;if(null!=(null!=(_ref=$scope.profile)?_ref.rules:void 0)){for($scope.hasUrlConditions=!1,_j=0,_len1=(_ref1=$scope.profile.rules).length;_j<_len1;_j++)if(rule=_ref1[_j],$scope.isUrlConditionType[rule.condition.conditionType]){$scope.hasUrlConditions=!0;break}if(0===$scope.hasConditionTypes){for(_results=[],_k=0,_len2=(_ref2=$scope.profile.rules).length;_k<_len2;_k++){if("TrueCondition"===(rule=_ref2[_k]).condition.conditionType&&(rule.condition={conditionType:"HostWildcardCondition",pattern:"*"}),!basicConditionTypeSet[rule.condition.conditionType]){$scope.hasConditionTypes=1,$scope.showConditionTypes=1;break}_results.push(void 0)}return _results}}},$scope.$watch('options["-showConditionTypes"]',(function(show){return show||(show=0),show>0?$scope.showConditionTypes=show:(updateHasConditionTypes(),$scope.showConditionTypes=$scope.hasConditionTypes),$scope.options["-exportLegacyRuleList"]?$scope.showConditionTypes>0?$scope.setExportRuleListHandler(exportRuleList,{warning:!0}):$scope.setExportRuleListHandler(exportLegacyRuleList):$scope.setExportRuleListHandler(exportRuleList),0!==$scope.showConditionTypes?($scope.conditionTypes=advancedConditionTypesExpanded,null==$scope.options["-showConditionTypes"]&&($scope.options["-showConditionTypes"]=$scope.showConditionTypes),"function"==typeof unwatchRules?unwatchRules():void 0):($scope.conditionTypes=basicConditionTypesExpanded,$scope.options["-exportLegacyRuleList"]?$scope.setExportRuleListHandler(exportLegacyRuleList):void 0)})),0===$scope.hasConditionTypes&&(unwatchRules=$scope.$watch("profile.rules",updateHasConditionTypes,!0)),rulesReadyDefer=$q.defer(),rulesReady=rulesReadyDefer.promise,stopWatchingForRules=$scope.$watch("profile.rules",(function(rules){if(rules)return stopWatchingForRules(),rulesReadyDefer.resolve(rules)})),$scope.addRule=function(){var rule,templ,_ref;return(rule=$scope.profile.rules.length>0?(templ=(_ref=$scope.profile.rules)[_ref.length-1],angular.copy(templ)):{condition:{conditionType:"HostWildcardCondition",pattern:""},profileName:$scope.attachedOptions.defaultProfileName}).condition.pattern&&(rule.condition.pattern=""),$scope.profile.rules.push(rule)},$scope.validateCondition=function(condition,pattern){if(condition.conditionType.indexOf("Regex")>=0)try{new RegExp(pattern)}catch(_error){return _error,!1}return!0},$scope.conditionHasWarning=function(condition){var pattern;return"HostWildcardCondition"===condition.conditionType&&((pattern=condition.pattern).indexOf(":")>=0||pattern.indexOf("/")>=0)},$scope.validateIpCondition=function(condition,input){return!!input&&null!=OmegaPac.Conditions.parseIp(input)},$scope.getWeekdayList=OmegaPac.Conditions.getWeekdayList,$scope.updateDay=function(condition,i,selected){var char;return condition.days||(condition.days="-------"),char=selected?"SMTWtFs"[i]:"-",condition.days=condition.days.substr(0,i)+char+condition.days.substr(i+1),delete condition.startDay,delete condition.endDay},$scope.removeRule=function(index){var removeForReal,scope;return removeForReal=function(){return $scope.profile.rules.splice(index,1)},$scope.options["-confirmDeletion"]?((scope=$scope.$new("isolate")).rule=$scope.profile.rules[index],scope.ruleProfile=$scope.profileByName(scope.rule.profileName),scope.dispNameFilter=$scope.dispNameFilter,scope.options=$scope.options,$modal.open({templateUrl:"partials/rule_remove_confirm.html",scope:scope}).result.then(removeForReal)):removeForReal()},$scope.cloneRule=function(index){var rule;return rule=angular.copy($scope.profile.rules[index]),$scope.profile.rules.splice(index+1,0,rule),$timeout((function(){var input,_ref,_ref1;return null!=(_ref=(input=angular.element(".switch-rule-row:nth-child("+(index+2)+") input"))[0])&&_ref.focus(),null!=(_ref1=input[0])?_ref1.select():void 0}))},$scope.showNotes=!1,$scope.addNote=function(index){return $scope.showNotes=!0,unwatchRulesShowNote()},unwatchRulesShowNote=$scope.$watch("profile.rules",(function(rules){if(rules&&rules.some((function(rule){return!!rule.note})))return $scope.showNotes=!0,unwatchRulesShowNote()}),!0),$scope.resetRules=function(){var scope;return(scope=$scope.$new("isolate")).ruleProfile=$scope.profileByName($scope.attachedOptions.defaultProfileName),scope.dispNameFilter=$scope.dispNameFilter,scope.options=$scope.options,$modal.open({templateUrl:"partials/rule_reset_confirm.html",scope:scope}).result.then((function(){var rule,_j,_len1,_ref,_results;for(_results=[],_j=0,_len1=(_ref=$scope.profile.rules).length;_j<_len1;_j++)rule=_ref[_j],_results.push(rule.profileName=$scope.attachedOptions.defaultProfileName);return _results}))},$scope.sortableOptions={handle:".sort-bar",tolerance:"pointer",axis:"y",forceHelperSize:!0,forcePlaceholderSize:!0,containment:"parent"},attachedReadyDefer=$q.defer(),attachedReady=attachedReadyDefer.promise,$scope.$watch("profile.name",(function(name){return $scope.attachedName=getAttachedName(name),$scope.attachedKey=OmegaPac.Profiles.nameAsKey($scope.attachedName)})),$scope.$watch("options[attachedKey]",(function(attached){return $scope.attached=attached})),$scope.watchAndUpdateRevision("options[attachedKey]"),oldSourceUrl=null,oldLastUpdate=null,oldRuleList=null,onAttachedChange=function(attached,oldAttached){if(attached&&oldAttached&&attached.sourceUrl!==oldAttached.sourceUrl){if(attached.lastUpdate)return oldSourceUrl=oldAttached.sourceUrl,oldLastUpdate=attached.lastUpdate,oldRuleList=oldAttached.ruleList,attached.lastUpdate=null;if(oldSourceUrl&&attached.sourceUrl===oldSourceUrl)return attached.lastUpdate=oldLastUpdate,attached.ruleList=oldRuleList}},$scope.$watch("options[attachedKey]",onAttachedChange,!0),$scope.attachedOptions={enabled:!1},$scope.$watch("profile.defaultProfileName",(function(name){if($scope.attachedOptions.enabled=name===$scope.attachedName,!$scope.attached||!$scope.attachedOptions.enabled)return $scope.attachedOptions.defaultProfileName=name})),$scope.$watch("attachedOptions.enabled",(function(enabled,oldValue){if(enabled!==oldValue)if(enabled){if($scope.profile.defaultProfileName!==$scope.attachedName)return $scope.profile.defaultProfileName=$scope.attachedName}else if($scope.profile.defaultProfileName===$scope.attachedName)return $scope.attached?($scope.profile.defaultProfileName=$scope.attached.defaultProfileName,$scope.attachedOptions.defaultProfileName=$scope.attached.defaultProfileName):($scope.profile.defaultProfileName="direct",$scope.attachedOptions.defaultProfileName="direct")})),$scope.$watch("attached.defaultProfileName",(function(name){if(name&&$scope.attachedOptions.enabled)return $scope.attachedOptions.defaultProfileName=name})),$scope.$watch("attachedOptions.defaultProfileName",(function(name){return attachedReadyDefer.resolve(),$scope.attached&&$scope.attachedOptions.enabled?$scope.attached.defaultProfileName=name:$scope.profile.defaultProfileName=name})),$scope.attachNew=function(){return $scope.attached=OmegaPac.Profiles.create({name:$scope.attachedName,defaultProfileName:$scope.profile.defaultProfileName,profileType:"RuleListProfile",color:$scope.profile.color}),OmegaPac.Profiles.updateRevision($scope.attached),$scope.options[$scope.attachedKey]=$scope.attached,$scope.attachedOptions.enabled=!0,$scope.profile.defaultProfileName=$scope.attachedName},$scope.removeAttached=function(){var scope;if($scope.attached)return(scope=$scope.$new("isolate")).attached=$scope.attached,scope.dispNameFilter=$scope.dispNameFilter,scope.options=$scope.options,$modal.open({templateUrl:"partials/delete_attached.html",scope:scope}).result.then((function(){return $scope.profile.defaultProfileName=$scope.attached.defaultProfileName,delete $scope.options[$scope.attachedKey]}))},stateEditorKey="web._profileEditor."+$scope.profile.name,$scope.loadRules=!1,$scope.editSource=!1,parseOmegaRules=function(code,_arg){var detect,key,name,refs,requireResult,setError,_ref;if(detect=(_ref=null!=_arg?_arg:{}).detect,requireResult=_ref.requireResult,setError=function(error){var args,message,_ref1;return error.reason&&(args=null!=(_ref1=error.args)?_ref1:[error.sourceLineNo,error.source],(message=trFilter("ruleList_error_"+error.reason,args))&&(error.message=message)),{error:error}},detect&&!OmegaPac.RuleList.Switchy.detect(code))return{error:{reason:"notSwitchy"}};if(refs=OmegaPac.RuleList.Switchy.directReferenceSet({ruleList:code}),requireResult&&!refs)return setError({reason:"resultNotEnabled"});for(key in refs)if(__hasProp.call(refs,key)&&(name=refs[key],!OmegaPac.Profiles.byKey(key,$scope.options)))return setError({reason:"unknownProfile",args:[name]});try{return{rules:OmegaPac.RuleList.Switchy.parseOmega(code,null,null,{strict:!0,source:!1})}}catch(_error){return setError(_error)}},parseSource=function(){var diff,error,oldRules,patch,rules,_ref;return!$scope.source||(rules=(_ref=parseOmegaRules($scope.source.code.trim(),{requireResult:!0})).rules,(error=_ref.error)?($scope.source.error=error,$scope.editSource=!0,!1):($scope.source.error=void 0,$scope.attachedOptions.defaultProfileName=rules.pop().profileName,diff=jsondiffpatch.create({objectHash:function(obj){return JSON.stringify(obj)},textDiff:{minLength:1/0}}),oldRules=angular.fromJson(angular.toJson($scope.profile.rules)),patch=diff.diff(oldRules,rules),jsondiffpatch.patch($scope.profile.rules,patch),!0))},$scope.toggleSource=function(){return $q.all([attachedReady,rulesReady]).then((function(){var args,code;if($scope.editSource=!$scope.editSource,$scope.editSource)args={rules:$scope.profile.rules,defaultProfileName:$scope.attachedOptions.defaultProfileName},code=OmegaPac.RuleList.Switchy.compose(args,{withResult:!0}),$scope.source={code:code};else{if(!parseSource())return;$scope.source=null,$scope.loadRules=!0}return omegaTarget.state(stateEditorKey,{editSource:$scope.editSource})}))},$rootScope.$on("$stateChangeStart",(function(event,_,__,fromState){if($scope.editSource&&$scope.source.touched&&!parseSource())return event.preventDefault()})),$scope.$on("omegaApplyOptions",(function(event){var error,_ref;if((null!=(_ref=$scope.attached)?_ref.ruleList:void 0)&&!$scope.attached.sourceUrl&&($scope.attachedRuleListError=void 0,(error=parseOmegaRules($scope.attached.ruleList.trim(),{detect:!0}).error)?"resultNotEnabled"!==error.reason&&"notSwitchy"!==error.reason&&($scope.attachedRuleListError=error,event.preventDefault(),angular.element("#attached-rulelist")[0].focus()):$scope.attached.format="Switchy"),$scope.editSource&&$scope.source.touched&&(event.preventDefault(),parseSource()))return $scope.source.touched=!1,$timeout((function(){return $rootScope.applyOptions()}))})),omegaTarget.state(stateEditorKey).then((function(opts){var getState;return(null!=opts?opts.editSource:void 0)?$scope.toggleSource():($scope.loadRules=!0,getState=omegaTarget.state(["web.switchGuide","firstRun"]),$q.all([rulesReady,getState]).then((function(_arg){var switchGuide,_ref;if(_arg[0],switchGuide=(_ref=_arg[1])[0],!_ref[1]&&"shown"!==switchGuide&&(omegaTarget.state("web.switchGuide","shown"),0!==$scope.profile.rules.length))return $script("js/switch_profile_guide.js")})))}))}))}.call(this),function(){angular.module("omega").directive("inputGroupClear",(function($timeout){return{restrict:"A",templateUrl:"partials/input_group_clear.html",scope:{model:"=model",type:"@type",ngPattern:"=?ngPattern",placeholder:"@placeholder",controller:"=?controller"},link:function(scope,element,attrs){return scope.catchAll=new RegExp(""),$timeout((function(){return scope.controller=element.find("input").controller("ngModel")})),scope.oldModel="",scope.controller=scope.input,scope.modelChange=function(){if(scope.model)return scope.oldModel=""},scope.toggleClear=function(){var _ref;return _ref=[scope.oldModel,scope.model],scope.model=_ref[0],scope.oldModel=_ref[1],_ref}}}})),angular.module("omega").directive("omegaUpload",(function(){return{restrict:"A",scope:{success:"&omegaUpload",error:"&omegaError"},link:function(scope,element,attrs){var input;return input=element[0],element.on("change",(function(){var reader;if(input.files.length>0&&input.files[0].name.length>0)return(reader=new FileReader).addEventListener("load",(function(e){return scope.$apply((function(){return scope.success({$content:e.target.result})}))})),reader.addEventListener("error",(function(e){return scope.$apply((function(){return scope.error({$error:e.target.error})}))})),reader.readAsText(input.files[0]),input.value=""}))}}})),angular.module("omega").directive("omegaIp2str",(function(){return{restrict:"A",priority:2,require:"ngModel",link:function(scope,element,attr,ngModel){return ngModel.$parsers.push((function(value){return value?OmegaPac.Conditions.fromStr("Ip: "+value):{conditionType:"IpCondition",ip:"0.0.0.0",prefixLength:0}})),ngModel.$formatters.push((function(value){return(null!=value?value.ip:void 0)?OmegaPac.Conditions.str(value).split(" ",2)[1]:""}))}}}))}.call(this),function(){angular.module("omega").filter("profiles",(function(builtinProfiles,profileOrder,isProfileNameHidden,isProfileNameReserved){var builtinProfileList,charCodePlus,profile,_;return charCodePlus="+".charCodeAt(0),builtinProfileList=function(){var _results;for(_ in _results=[],builtinProfiles)profile=builtinProfiles[_],_results.push(profile);return _results}(),function(options,filter){var name,result,value;for(name in result=[],options)value=options[name],name.charCodeAt(0)===charCodePlus&&result.push(value);return("object"==typeof filter||"string"==typeof filter&&filter.charCodeAt(0)===charCodePlus)&&("string"==typeof filter&&(filter=filter.substr(1)),result=OmegaPac.Profiles.validResultProfilesFor(filter,options)),"all"===filter?(result=result.filter((function(profile){return!isProfileNameHidden(profile.name)})),result=result.concat(builtinProfileList)):result=result.filter((function(profile){return!isProfileNameReserved(profile.name)})),"sorted"===filter&&result.sort(profileOrder),result}})),angular.module("omega").filter("tr",(function(omegaTarget){return omegaTarget.getMessage})),angular.module("omega").filter("dispName",(function(omegaTarget){return function(name){return"object"==typeof name&&(name=name.name),omegaTarget.getMessage("profile_"+name)||name}}))}.call(this);